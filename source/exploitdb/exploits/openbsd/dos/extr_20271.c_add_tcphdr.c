#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  uint8_t ;
typedef  int /*<<< orphan*/  u_short ;
typedef  int /*<<< orphan*/  tcp ;
struct tcphdr {int protocol; int th_off; int th_seq; int /*<<< orphan*/  th_sum; void* th_win; int /*<<< orphan*/  th_flags; void* tot_len; scalar_t__ zero; int /*<<< orphan*/  daddr; int /*<<< orphan*/  saddr; int /*<<< orphan*/  th_sport; int /*<<< orphan*/  th_dport; } ;
struct net_tuple {int /*<<< orphan*/  dst; int /*<<< orphan*/  src; int /*<<< orphan*/  sport; int /*<<< orphan*/  dport; } ;
struct _fakehead {int protocol; int th_off; int th_seq; int /*<<< orphan*/  th_sum; void* th_win; int /*<<< orphan*/  th_flags; void* tot_len; scalar_t__ zero; int /*<<< orphan*/  daddr; int /*<<< orphan*/  saddr; int /*<<< orphan*/  th_sport; int /*<<< orphan*/  th_dport; } ;
typedef  int /*<<< orphan*/  fakehead ;

/* Variables and functions */
 int /*<<< orphan*/  CKSUM_CARRY (int) ; 
 int TCP_SIZE ; 
 void* htons (int) ; 
 int in_cksum (int /*<<< orphan*/ *,int) ; 
 int /*<<< orphan*/  memcpy (unsigned char*,struct tcphdr*,int) ; 
 int /*<<< orphan*/  memset (struct tcphdr*,int /*<<< orphan*/ ,int) ; 

void
add_tcphdr(unsigned char *pkt, struct net_tuple *nt, uint8_t flags)
{
   struct tcphdr                tcp;
   struct _fakehead             fakehead;
   int sum;

   memset(&tcp, 0, sizeof(tcp));
   memset(&fakehead, 0, sizeof(fakehead));

   tcp.th_dport = nt->dport;
   tcp.th_sport = nt->sport;
   fakehead.saddr = nt->src;
 fakehead.daddr = nt->dst;
   fakehead.zero = 0,
   fakehead.protocol = 6;
   fakehead.tot_len = htons(TCP_SIZE);
   sum = in_cksum((u_short *)&fakehead, sizeof(fakehead));
   tcp.th_off = TCP_SIZE >> 2;
   tcp.th_seq = 31337;                         /* ###fixme */
   tcp.th_flags |= flags;                      /* ADD the flags */
   tcp.th_win = htons(0x3fff);
   sum += in_cksum((u_short *)&tcp, sizeof(tcp));
   tcp.th_sum = CKSUM_CARRY(sum);
   memcpy(pkt, &tcp, sizeof(tcp));
}