#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int /*<<< orphan*/  exit (int) ; 
 int /*<<< orphan*/  memcpy (char*,char*,int) ; 
 int /*<<< orphan*/  printf (char*) ; 
 int /*<<< orphan*/  send (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  strcpy (char*,char*) ; 
 int strlen (char*) ; 

int send_bind_request(int sock, char method, char* dn, char* cred)
{
	int cred_len, message_len, request_len;
	char krb_bind_request[2000];
	char* p;

	memcpy(krb_bind_request,
		"\x30\x82\xff\xff"	/* request length */
		"\x02\x01\x01"		/* message id = 1 */
		"\x60"				/* bind request */
		"\x82\xff\xff"		/* message length */
		"\x02\x01\x02"		/* LDAP version 3 */
		"\x04",				/* dn */
	15);
	
	p = &krb_bind_request[15];
	
	if (strlen(dn) > 255) {
		printf("bind_dn too long\n");
		exit(1);
	}

	*p++ = (char)strlen(dn);
	strcpy(p, dn);

	p += strlen(dn);
	
	*p++ = method;		/* authentication method */
	*p++ = '\x82';

	cred_len = strlen(cred);
	
	*p++ = (char) ((cred_len >> 8) & 0xff);
	*p++ = (char) (cred_len & 0xff);
	
	strcpy(p, cred);
	
	message_len = 5 + strlen(dn) + 4 + cred_len;
	krb_bind_request[9] = (char) ((message_len >> 8) & 0xff);
	krb_bind_request[10] = (char) (message_len & 0xff);

	request_len = 7 + message_len;
	krb_bind_request[2] = (char) ((request_len >> 8) & 0xff);
	krb_bind_request[3] = (char) (request_len & 0xff);
	
	send(sock, krb_bind_request, 4+request_len, 0);
}