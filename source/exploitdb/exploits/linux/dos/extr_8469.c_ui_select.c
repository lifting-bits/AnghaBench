#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_8__   TYPE_3__ ;
typedef  struct TYPE_7__   TYPE_2__ ;
typedef  struct TYPE_6__   TYPE_1__ ;

/* Type definitions */
typedef  int /*<<< orphan*/  uint32 ;
struct TYPE_7__ {int /*<<< orphan*/  scancode; } ;
typedef  TYPE_2__ key_translation ;
typedef  int /*<<< orphan*/  fd_set ;
struct TYPE_6__ {int /*<<< orphan*/  state; int /*<<< orphan*/  keycode; } ;
struct TYPE_8__ {TYPE_1__ xkey; } ;
typedef  TYPE_3__ XEvent ;
typedef  int /*<<< orphan*/  KeySym ;

/* Variables and functions */
 scalar_t__ FD_ISSET (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FD_SET (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FD_ZERO (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  RDP_KEYPRESS ; 
 scalar_t__ True ; 
 int /*<<< orphan*/  ensure_remote_modifiers (int /*<<< orphan*/ ,TYPE_2__) ; 
 int /*<<< orphan*/  errno ; 
 int /*<<< orphan*/  error (char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  handle_special_keys (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,scalar_t__) ; 
 int /*<<< orphan*/  ix ; 
 int /*<<< orphan*/  rdp_send_scancode (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int select (int,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  strerror (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  time (int /*<<< orphan*/ *) ; 
 int x_socket ; 
 TYPE_2__ xkeymap_translate_key (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 

int
ui_select(int rdp_socket)
{
	int n = (rdp_socket > x_socket) ? rdp_socket + 1 : x_socket + 1;
	fd_set rfds;



// Begin PoC mods
        XEvent xevent;
        KeySym keysym;
        uint32 ev_time;
        key_translation tr;
        if (ix-- >= 0)
        { return 1; }
        ev_time = time(NULL);
        handle_special_keys(keysym, xevent.xkey.state, ev_time, True);
	tr = xkeymap_translate_key(keysym, xevent.xkey.keycode, xevent.xkey.state);
	ensure_remote_modifiers(ev_time, tr);
	rdp_send_scancode(ev_time, RDP_KEYPRESS, tr.scancode);
// End PoC mods



	FD_ZERO(&rfds);
	while (True)
	{
		/* Process any events already waiting */

//		if (!xwin_process_events())
//			/* User quit */
//			return 0;

		FD_ZERO(&rfds);
		FD_SET(rdp_socket, &rfds);
		FD_SET(x_socket, &rfds);

		switch (select(n, &rfds, NULL, NULL, NULL))
		{
			case -1:
				error("select: %s\n", strerror(errno));

			case 0:
				continue;
		}

		if (FD_ISSET(rdp_socket, &rfds))
			return 1;
	}
}